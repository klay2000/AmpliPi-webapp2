#!/usr/bin/env bash
# Update the offline/online state
set -e

USER_CACHE_DIR="$HOME/.cache/amplipi"

# add file if needed
if [ ! -e $USER_CACHE_DIR/online ]; then
  mkdir -p $USER_CACHE_DIR
  touch $USER_CACHE_DIR/online
fi

# Check if we can reach the internet without dns
last_online=$(cat $USER_CACHE_DIR/online)
online=$(nc -w 5 -z 1.1.1.1 53 >/dev/null 2>&1 && echo online || echo offline)

# only update online state as needed
if [ "$last_online" != "$online" ]; then
  echo "$online" > $USER_CACHE_DIR/online
fi
